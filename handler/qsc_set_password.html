<!DOCTYPE html>
<html>

<head>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>
        window.onload = function(){
            $.ajax("../profile", {
                    method: "GET",
                    beforeSend: function (xhr) {
                        xhr.withCredentials = true
                    },
                    xhrFields: {
                        withCredentials: true
                    },
                    success: function (resp) {
                        if (resp.code != 0) {
                            window.alert(JSON.stringify(resp))
                            return
                        }
                        if (!resp?.data?.logined || resp?.data?.user?.LoginType!="qsc") {
                            window.alert("请先登录求是潮")
                            window.location.href = "login?success=set_password"
                        }
                        $("#username").text(resp?.data?.user?.name + " " + resp?.data?.user?.qscid)
                    }
            })
        };

        function set_password() {
            var p1 = $("#input-password1").val();
            var p2 = $("#input-password2").val();
            if (p1 != p2) {
                window.alert("两次密码不一样！")
                return
            }
            $.ajax("set_password", {
                method: "POST",
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify({
                    password: p1
                }),
                beforeSend: function (xhr) {
                    xhr.withCredentials = true
                },
                xhrFields: {
                    withCredentials: true
                },
                success: function (resp) {
                    if (resp.code != 0) {
                        window.alert(JSON.stringify(resp))
                        return
                    }
                    const params = new URLSearchParams(window.location.search);
                    window.location.href = params.get("success")
                }
            })
        }
    </script>
    <style>
        body,
        html {
            height: 95%;
        }
    </style>
</head>

<body>
    <div
        style="display: flex; justify-content: center; align-items: center;  background: linear-gradient(to right, #78ffd6, #007991); height: 100%; border-radius: 20px;">
        <div>
            <h1 style="color: rgb(50, 70, 75);">QSC密码重置</h1>
            <div id="profile" style="margin-left: 5px; padding-bottom: 20px; font-weight: bold;">当前用户：            <div id="username" style="display: inline;" >未登录</div></div>
            <div style="margin-left: 5px;">New Password</div>
            <input id="input-password1" type="password" style="margin: 10px; width: 200px; height: 30px;" /><br />
            <div style="margin-left: 5px;">Input Again</div>
            <input id="input-password2" type="password" style="margin: 10px; width: 200px; height: 30px;" /><br />
            <button class="btn" onclick="set_password()"
                style="margin-top: 20px;margin-left: 60px; width: 100px;">修改</button> <br />
        </div>
    </div>
</body>

</html>